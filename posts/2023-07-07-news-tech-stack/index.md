---
title: "é‰…äº¨ç¶²æ–°èå°ˆæ¡ˆæ”¹ç‰ˆ"
date: 2023-07-14
tags:
  - ï¼·ork
---

## ç›®éŒ„

- [æ”¹ç‰ˆåŸå› ](#æ”¹ç‰ˆåŸå› )
- [Tech Stack](#tech-stack)
- [å»ºç«‹å°ˆæ¡ˆ](#å»ºç«‹å°ˆæ¡ˆ)
- [Next13](#next13)
- [çµè«–](#çµè«–)

## <h2 id="æ”¹ç‰ˆåŸå› ">æ”¹ç‰ˆåŸå› </h2>

[é‰…äº¨ç¶²æ–°èç¶²ç«™](https://news.cnyes.com/news/cat/headline)å¤§ç´„æ˜¯ 2017 åšäº†ä¸€æ¬¡æ”¹ç‰ˆ,ç•¶æ™‚ä½¿ç”¨çš„ç›¸é—œæŠ€è¡“æ˜¯ Node8, React15, Redux èˆ‡å‰äººæ‰¾äº†ä¸€å€‹ä½¿ç”¨ Express å¯¦ä½œ Server Side Render çš„æ¨£æ¿ä½œç‚ºåŸºåº•ã€‚å…­å¹´å¾Œçš„ 2023,ç›®å‰ Node ç©©å®šç‰ˆæœ¬å·²ç¶“ä¾†åˆ° 18, React18,ä¹Ÿé™¸çºŒå‡ºç¾å¯¦ä½œ SSR çš„æ¡†æ¶ä¾‹å¦‚ Nextjs, Remixã€‚

React16.8 æ¨å‡º React hooks å¯«æ³•å¾Œ, å¯« Class Component çš„äººå°±è¶Šä¾†è¶Šå°‘, å‰äººä¸€é–‹å§‹å»ºç«‹çš„ MVC æ¶æ§‹èˆ‡ Redux ä¹Ÿéš¨è‘—ç¶“æ‰‹çš„äººè¶Šä¾†è¶Šå¤šæ¼¸æ¼¸çš„é é›¢ä¸€é–‹å§‹çš„è¦åŠƒ, ç¾åœ¨èƒ½åœ¨çœ‹è¦‹ View å±¤å‘¼å« API, æ‰€æœ‰çš„å¯¦ä½œé‚è¼¯éƒ½é›†ä¸­åœ¨ä¸€å€‹æª”æ¡ˆ, ä¸€å€‹æª”æ¡ˆæœ‰ 1700 å¤šè¡Œ, ç•¶ state, props æ”¹è®Šæ™‚æœƒé€ æˆå¤šé¤˜çš„ç•«é¢é‡æ–°æ¸²æŸ“, å¾ŒçºŒæ¥æ‰‹çš„äººä¹Ÿè¶Šä¾†è¶Šæ”¹ä¸å‹•ã€‚

Node ç‰ˆæœ¬éèˆŠ,ä¸€äº›æ–°çš„ JavaScript èªæ³•ä¸æ”¯æ´,ç›¸é—œå¥—ä»¶åªå®‰è£è¼ƒèˆŠçš„ç‰ˆæœ¬æˆ–æ˜¯ä¸èƒ½ä½¿ç”¨ã€‚

## <h2 id="tech-stack">Tech Stack</h2>

- [Next13](https://nextjs.org/)
- [React18](https://react.dev/)
- [Node18](https://nodejs.org/en)
- [Linaria](https://github.com/callstack/linaria)
- [Nx](https://nx.dev/)

åœ¨è€ƒæ…® SEO æƒ…æ³ä¸‹å‹¢å¿…æ˜¯è¦é¸æ“‡ SSR, Next åœ¨è™•ç† SSR èˆ‡ CSR ä¹‹é–“å·²ç¶“è™•ç†æ‰å¾ˆå¤šå•é¡Œ, åŠ ä¸Š Next13 å·²ç”± beta ç‰ˆæœ¬è®Šç‚ºç©©å®šç‰ˆæœ¬ã€‚æ–°çš„[Server Component](https://nextjs.org/blog/next-13)æ‡‰è©²ä¹Ÿè§£æ±ºäº†å¾ˆå¤š Client èˆ‡ Server é–“çš„å•é¡Œã€‚

Linaria æ˜¯ä¸€å€‹ CSS çš„æ¡†ä»¶,ä¸»æ‰“æ˜¯ Zero-runtime CSS in JS, æ¥­ç•Œæ¨™ç«¿ Airbnb ä¹Ÿå°å…¥äº†é€™å€‹ CSS library[Airbnbâ€™s Trip to Linaria](https://medium.com/airbnb-engineering/airbnbs-trip-to-linaria-dc169230bd12)

Nx å‰‡æ˜¯å¸Œæœ›æœªä¾†èƒ½å¤ æ•´åˆæ¨ç‰ˆæµç¨‹, ç›®å‰é‰…äº¨ç¶²çš„å°ˆæ¡ˆæ˜¯ä¸€å€‹é …ç›®å°±é–‹ä¸€å€‹ gitlab repository, ç›®å‰å¤§ç´„æœ‰æ¥è¿‘ 10 å€‹ repository, æœƒé€ æˆä¸€å€‹ç›¸åŒçš„åŠŸèƒ½åœ¨ A,B,C å°ˆæ¡ˆéƒ½è¦ç”¨åˆ°, å°±å¿…é ˆè¦æ¨ 3 æ¬¡ç‰ˆ, å¦‚æœæ˜¯å‹•åˆ° Header å…¨éƒ¨å°ˆæ¡ˆéƒ½æœ‰ç”¨åˆ°å°±å¿…é ˆæ¯å€‹å°ˆæ¡ˆéƒ½å„åˆ¥æ¨ç‰ˆã€‚Nx æ˜¯å…¶ä¸­ä¸€å€‹ monorepo æ¶æ§‹çš„å¯¦ä½œ,æœªä¾†å¦‚æœå°ˆæ¡ˆéƒ½æ•´åˆåˆ° monorepo ä¸­èƒ½å¤ æ”¹å–„æ¨å¾ˆå¤šæ¬¡ç‰ˆçš„å•é¡Œã€‚

## <h2 id="å»ºç«‹å°ˆæ¡ˆ">å»ºç«‹å°ˆæ¡ˆ</h2>

1. å»ºç«‹ nx monorepo çµæ§‹(å…ˆåˆ‡æ›è‡³ node18)

```shell
npx create-nx-workspace@latest --preset=next --packageManager=pnpm
# è¼¸å…¥workspaceåç¨±/çµ„ç¹”åç¨± e.g. org
# è¼¸å…¥nextå°ˆæ¡ˆåç¨± e.g. news
# ç”¢ç”Ÿçš„ç›®éŒ„çµæ§‹ï¼š
# org
#  - apps
#    - news
#  - libs
```

2. å•Ÿå‹•å°ˆæ¡ˆ

```shell
pnpm nx serve news
# åœ¨app/news/prject.jsonæœƒå®šç¾©å°ˆæ¡ˆçš„æŒ‡ä»¤,ä¾‹å¦‚serve
# å°±å¯ä»¥å¾workspaceä¾†æ§åˆ¶æ‰€æœ‰å°ˆæ¡ˆæŒ‡ä»¤,ä¾‹å¦‚å•Ÿå‹•,æ–°å¢,åˆªé™¤ç­‰ç­‰
# é è¨­æ˜¯localhost:4200
```

3. å»ºç«‹ ui å…±ç”¨å…ƒä»¶åº«åˆ° libs è³‡æ–™å¤¾ä¸‹

```shell
pnpm nx g @nx/react:lib ui
# org
#   - libs
#     - ui
```

nx æä¾›ä¸€äº›ç¨‹å¼ç¢¼æ¨¡æ¿å¯ä»¥ç”¢ç”Ÿå„ç¨®ç¯„ä¾‹,ä¾‹å¦‚é€™è£¡ç”¢ç”Ÿ lib,æ˜¯ä½¿ç”¨@nx/react:lib æ¨¡æ¿, g æ˜¯ generate ç¸®å¯«

4. ç”Ÿæˆå…±ç”¨å…ƒä»¶åˆ° lib/ui, å¦‚ header

```shell
pnpm nx g @nx/react:component header --project=ui
# CREATE libs/ui/src/lib/header/header.spec.tsx
# CREATE libs/ui/src/lib/header/header.tsx
# UPDATE libs/ui/src/index.ts
```

5. åœ¨ news ä¸­ä½¿ç”¨å…±ç”¨å…ƒä»¶

```ts
// apps/news/app/layout.tsx
import { Header } from '@org/ui';
...
return (
    <html lang="en">
      <body>
        <Header />
        {children}
      </body>
    </html>
  );
...
```

![next-with-header](./step5.png)

6. å®‰è£[Linaria](https://github.com/callstack/linaria)

```shell
pnpm i next-with-linaria @linaria/babel-preset @linaria/core @linaria/react
```

next13 å’Œ linaria æ•´åˆé‚„æœ‰é»å•é¡Œ, [next-with-linaria](https://github.com/dlehmhus/next-with-linaria)æå‡ºäº†è§£æ³•,ä½†æ˜¯åœ¨ readme ä¸­ä¹Ÿå¯«åˆ°æ­£åœ¨é–‹ç™¼ä¸­ä¸è¦ç”¨åˆ° prod ä¸­,éœ€è¦å†æŒçºŒçœ‹ä¹‹å¾Œæœ‰ä»€éº¼æ–°çš„æ•´åˆæ–¹å¼ã€‚

```ts
// next.config.ts
const withLinaria = require("next-with-linaria");
const plugins = [withNx, withLinaria];
```

```ts
import { styled } from "@linaria/react";
const Title = styled.h1`
  color: red;
  font-size: 36px;
`;
```

```tsx
<div id="welcome">
  <Title>
    <span> Hello there, </span>
    Welcome news ğŸ‘‹
  </Title>
</div>
```

![linaria-title](./step6.png)

## <h2 id="next13">Next13</h2>

- Next13 çš„ App routing, åŠ å¼·äº†ä»¥å‰ pages routing æ–¹å¼, æ•´åˆäº† layout, loading, error ç­‰åŠŸèƒ½ã€‚
- é è¨­æ˜¯ Server Component, ä¹Ÿæ¨æ£„æ‰ä»¥å‰çš„ getInitialProps, getServerPropsã€‚å¦‚æœæ˜¯ Client Component éœ€è¦åœ¨é–‹é ­çš„åœ°æ–¹åŠ ä¸Š'use client'
- Next13 é‡å° fetch å„ªåŒ–, æ”¯æ´ cache å’Œ revalidate

[Next.js App Router: Routing, Data Fetching, Caching - Vercel](https://www.youtube.com/watch?v=gSSsZReIFRk)

## <h2 id="çµè«–">çµè«–</h2>

- åœ¨æ”¹ç‰ˆéƒ¨åˆ†ç¢°ä¸Šäº†ä¸€äº›æŒ‘æˆ°,ç›®å‰æ˜¯é‡æ–°é–‹å•Ÿä¸€å€‹æ–°çš„å°ˆæ¡ˆè€Œä¸æ˜¯èˆŠç‰ˆçš„ç¹¼çºŒå¾€ä¸Šå‡ç´š,ä¸»è¦è€ƒé‡æ˜¯å‡ç´šæ‡‰è©²æœƒæ›´æ£˜æ‰‹ã€‚å¾Œé¢æœƒé™¸çºŒç¢°åˆ°èˆŠå…ƒä»¶å…±ç”¨/é‡åšå•é¡Œã€CICD å•é¡Œã€å¿«å–å•é¡Œã€ç™»å…¥å•é¡Œã€‚
- ç›®å‰é‚„åœ¨è£½ä½œ prototype,æœ‰ä¸€å€‹ monorepo çµæ§‹åŒ…å« Nextjs å°ˆæ¡ˆå’Œä¸€å€‹å…±ç”¨ UI å°ˆæ¡ˆ, ä¹‹å¾Œå°ˆæ¡ˆå¦‚æœä¹Ÿè¦å‡ç´šæœƒä¸€èµ·æ•´åˆåˆ° monorepo ä¸­ã€‚
